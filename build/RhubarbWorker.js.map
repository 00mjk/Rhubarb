{"version":3,"file":"RhubarbWorker.js","sources":["../js/worker/WebSocketWorker.js"],"sourcesContent":["var WebSocketWorker = function(){\n  this.pingMsg = new Float32Array(1);\n}\n\nWebSocketWorker.prototype.sendPing = function(){\n  if (worker.isSocketClosed){\n    return;\n  }\n  //worker.ws.send(worker.pingMsg.buffer);\n  worker.lastPingSendTime = performance.now();\n}\n\nWebSocketWorker.prototype.onWSOpen = function(){\n  worker.isSocketClosed = false;\n  postMessage({isConnected: true});\n  setTimeout(this.sendPing, 3000);\n}\n\nWebSocketWorker.prototype.onWSMessage = function(event){\n  worker.latency = performance.now() - worker.lastPingSendTime;\n  var view = new Float32Array(event.data);\n  var protocolID = view[0];\n  if (protocolID == 0){\n    setTimeout(worker.sendPing, 3000);\n  }\n}\n\nWebSocketWorker.prototype.onWSClose = function(){\n  console.log(\"SDFSDF\");\n  worker.isSocketClosed = true;\n}\n\nWebSocketWorker.prototype.onWSError = function(event){\n  postMessage({isError: true});\n}\n\nWebSocketWorker.prototype.connect = function(serverURL){\n  var ws = new WebSocket(serverURL);\n  ws.onopen = this.onWSOpen.bind(this);\n  ws.onmessage = this.onWSMessage.bind(this);\n  ws.onclose = this.onWSClose.bind(this);\n  ws.onerror = this.onWSError.bind(this);\n  ws.binaryType = \"arraybuffer\";\n  this.ws = ws;\n}\n\nvar worker = new WebSocketWorker();\n\nself.onmessage = function(message){\n  var data = message.data;\n\n  if (data.serverURL){\n    worker.connect(data.serverURL);\n  }\n}\n"],"names":["WebSocketWorker","pingMsg","Float32Array","prototype","sendPing","worker","isSocketClosed","lastPingSendTime","performance","now","onWSOpen","isConnected","onWSMessage","event","latency","view","data","protocolID","onWSClose","log","onWSError","isError","connect","serverURL","ws","WebSocket","onopen","bind","onmessage","onclose","onerror","binaryType","self","message"],"mappings":";;;;;;AAAA,IAAIA,kBAAkB,SAAlBA,eAAkB,GAAU;OACzBC,OAAL,GAAe,IAAIC,YAAJ,CAAiB,CAAjB,CAAf;CADF;;AAIAF,gBAAgBG,SAAhB,CAA0BC,QAA1B,GAAqC,YAAU;MACzCC,OAAOC,cAAX,EAA0B;;;;SAInBC,gBAAP,GAA0BC,YAAYC,GAAZ,EAA1B;CALF;;AAQAT,gBAAgBG,SAAhB,CAA0BO,QAA1B,GAAqC,YAAU;SACtCJ,cAAP,GAAwB,KAAxB;cACY,EAACK,aAAa,IAAd,EAAZ;aACW,KAAKP,QAAhB,EAA0B,IAA1B;CAHF;;AAMAJ,gBAAgBG,SAAhB,CAA0BS,WAA1B,GAAwC,UAASC,KAAT,EAAe;SAC9CC,OAAP,GAAiBN,YAAYC,GAAZ,KAAoBJ,OAAOE,gBAA5C;MACIQ,OAAO,IAAIb,YAAJ,CAAiBW,MAAMG,IAAvB,CAAX;MACIC,aAAaF,KAAK,CAAL,CAAjB;MACIE,cAAc,CAAlB,EAAoB;eACPZ,OAAOD,QAAlB,EAA4B,IAA5B;;CALJ;;AASAJ,gBAAgBG,SAAhB,CAA0Be,SAA1B,GAAsC,YAAU;UACtCC,GAAR,CAAY,QAAZ;SACOb,cAAP,GAAwB,IAAxB;CAFF;;AAKAN,gBAAgBG,SAAhB,CAA0BiB,SAA1B,GAAsC,UAASP,KAAT,EAAe;cACvC,EAACQ,SAAS,IAAV,EAAZ;CADF;;AAIArB,gBAAgBG,SAAhB,CAA0BmB,OAA1B,GAAoC,UAASC,SAAT,EAAmB;MACjDC,KAAK,IAAIC,SAAJ,CAAcF,SAAd,CAAT;KACGG,MAAH,GAAY,KAAKhB,QAAL,CAAciB,IAAd,CAAmB,IAAnB,CAAZ;KACGC,SAAH,GAAe,KAAKhB,WAAL,CAAiBe,IAAjB,CAAsB,IAAtB,CAAf;KACGE,OAAH,GAAa,KAAKX,SAAL,CAAeS,IAAf,CAAoB,IAApB,CAAb;KACGG,OAAH,GAAa,KAAKV,SAAL,CAAeO,IAAf,CAAoB,IAApB,CAAb;KACGI,UAAH,GAAgB,aAAhB;OACKP,EAAL,GAAUA,EAAV;CAPF;;AAUA,IAAInB,SAAS,IAAIL,eAAJ,EAAb;;AAEAgC,KAAKJ,SAAL,GAAiB,UAASK,OAAT,EAAiB;MAC5BjB,OAAOiB,QAAQjB,IAAnB;;MAEIA,KAAKO,SAAT,EAAmB;WACVD,OAAP,CAAeN,KAAKO,SAApB;;CAJJ;;;;"}